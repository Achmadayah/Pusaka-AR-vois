<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigale Gale 3D</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer@^2.1.1/dist/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #8B4513, #D2691E);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .model-container {
            width: 100%;
            height: 450px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
            border-radius: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .model-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            border: none;
            border-radius: 10px;
            padding: 12px 18px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #A0522D, #CD853F);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .object-title {
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: #FFD700;
            font-weight: bold;
        }

        .object-description {
            line-height: 1.7;
            font-size: 1.15rem;
            text-align: center;
            margin-bottom: 25px;
            opacity: 0.95;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #FFD700;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }

        .audio-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: none;
            color: #8B4513;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .audio-btn:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .cultural-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8B4513, #D2691E);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .file-input-container {
            text-align: center;
            margin-bottom: 15px;
        }

        .file-input {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .file-input:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        @media (max-width: 768px) {
            .model-container {
                height: 350px;
            }
            
            .container {
                padding: 20px;
            }
            
            .model-controls {
                gap: 8px;
            }
            
            .control-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            
            .object-title {
                font-size: 1.8rem;
            }
            
            .object-description {
                font-size: 1rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 15px;">
            <div class="cultural-badge">Warisan Budaya Batak</div>
        </div>

        <div class="file-input-container">
            <label class="file-input">
                üìÅ Upload Model 3D (GLB)
                <input type="file" id="model-upload" accept=".glb" style="display: none;">
            </label>
        </div>
        
        <div class="model-container">
            <div class="loading-overlay" id="loading-overlay">
                <div class="spinner"></div>
                <div>Pilih file model 3D (.glb)</div>
            </div>
            <model-viewer 
                id="model-viewer"
                alt="Model 3D Sigale Gale"
                auto-rotate 
                camera-controls
                shadow-intensity="1.5"
                environment-image="neutral"
                camera-orbit="0deg 75deg 105%"
                exposure="1.5">
                
                <div slot="poster">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%; color: white;">
                        Model 3D belum dimuat
                    </div>
                </div>
            </model-viewer>
        </div>
        
        <div class="model-controls">
            <button class="control-btn" id="reset-view">
                <span>‚Ü∫</span> Reset Posisi
            </button>
            <button class="control-btn" id="auto-rotate">
                <span>üîÑ</span> Putar Otomatis
            </button>
            <button class="control-btn" id="zoom-in">
                <span>üîç</span> Perbesar
            </button>
            <button class="control-btn" id="zoom-out">
                <span>üëÅÔ∏è</span> Perkecil
            </button>
        </div>
        
        <h2 class="object-title">Sigale Gale</h2>
        <p class="object-description">
            Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, 
            yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan 
            dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. 
            Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak 
            dengan ukiran dan warna khas.
        </p>
        
        <div class="audio-controls">
            <button class="audio-btn" id="play-btn">‚ñ∂</button>
        </div>
    </div>

    <script>
        // Elemen DOM
        const playBtn = document.getElementById('play-btn');
        const modelViewer = document.getElementById('model-viewer');
        const resetViewBtn = document.getElementById('reset-view');
        const autoRotateBtn = document.getElementById('auto-rotate');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const loadingOverlay = document.getElementById('loading-overlay');
        const modelUpload = document.getElementById('model-upload');

        let currentAudio = null;
        let isPlaying = false;
        let isAutoRotating = true;

        // Event listener untuk upload file
        modelUpload.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.name.toLowerCase().endsWith('.glb')) {
                    loadModelFromFile(file);
                } else {
                    alert('Silakan pilih file dengan format .glb');
                }
            }
        });

        // Fungsi untuk memuat model dari file
        function loadModelFromFile(file) {
            loadingOverlay.innerHTML = `
                <div class="spinner"></div>
                <div>Memuat model 3D...</div>
            `;
            loadingOverlay.style.display = 'flex';

            const reader = new FileReader();
            
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                
                // Buat blob URL dari array buffer
                const blob = new Blob([arrayBuffer], { type: 'model/gltf-binary' });
                const url = URL.createObjectURL(blob);
                
                // Set source model viewer
                modelViewer.src = url;
                
                // Event listener untuk success
                modelViewer.addEventListener('load', () => {
                    console.log('Model berhasil dimuat');
                    loadingOverlay.style.display = 'none';
                    
                    // Setel pencahayaan yang optimal
                    modelViewer.exposure = 1.8;
                    modelViewer.shadowIntensity = 1.8;
                    
                    // Reset camera
                    resetView();
                });

                // Event listener untuk error
                modelViewer.addEventListener('error', (event) => {
                    console.error('Error loading model:', event);
                    loadingOverlay.innerHTML = `
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; margin-bottom: 10px;">‚ö†Ô∏è</div>
                            <div>Gagal memuat model 3D</div>
                            <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">
                                Format file mungkin tidak didukung
                            </div>
                        </div>
                    `;
                });
            };

            reader.onerror = function() {
                loadingOverlay.innerHTML = `
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">‚ùå</div>
                        <div>Gagal membaca file</div>
                    </div>
                `;
            };

            reader.readAsArrayBuffer(file);
        }

        // Fallback: Coba load dari URL default jika ada
        function tryLoadDefaultModel() {
            // Ganti dengan path ke file GLB Anda jika ada
            const defaultModelUrl = 'scene.glb';
            
            // Cek jika file ada dengan fetch
            fetch(defaultModelUrl, { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        modelViewer.src = defaultModelUrl;
                        loadingOverlay.innerHTML = `
                            <div class="spinner"></div>
                            <div>Memuat model default...</div>
                        `;
                    }
                })
                .catch(() => {
                    // File tidak ada, tetap tampilkan upload
                    loadingOverlay.innerHTML = `
                        <div style="text-align: center;">
                            <div>Pilih file model 3D (.glb)</div>
                            <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">
                                Upload file GLB untuk menampilkan model
                            </div>
                        </div>
                    `;
                });
        }

        // Fungsi untuk text-to-speech
        function speakText(text) {
            if (currentAudio && isPlaying) {
                currentAudio.pause();
                isPlaying = false;
                playBtn.textContent = '‚ñ∂';
            }

            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    isPlaying = true;
                    playBtn.textContent = '‚è∏';
                    playBtn.style.background = 'linear-gradient(135deg, #FF8C00, #FF6347)';
                };
                
                utterance.onend = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                    autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
                    modelViewer.autoRotate = false;
                    isAutoRotating = false;
                    resetView();
                };
                
                utterance.onerror = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                };
                
                speechSynthesis.speak(utterance);
                currentAudio = utterance;
                
                modelViewer.autoRotate = true;
                isAutoRotating = true;
                autoRotateBtn.innerHTML = '<span>‚è∏</span> Berhenti';
                
            } else {
                const audio = new Audio("https://www.soundjay.com/button/beep-07.wav");
                audio.play();
                
                isPlaying = true;
                playBtn.textContent = '‚è∏';
                playBtn.style.background = 'linear-gradient(135deg, #FF8C00, #FF6347)';
                
                audio.onended = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                };
                
                currentAudio = audio;
            }
        }

        // Fungsi reset view
        function resetView() {
            modelViewer.cameraOrbit = "0deg 75deg 105%";
            modelViewer.autoRotate = false;
            isAutoRotating = false;
            autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
        }

        // Teks untuk voice over
        const voiceOverText = "Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak dengan ukiran dan warna khas. Gerakan patung ini dikendalikan oleh tali-tali yang dioperasikan oleh beberapa orang, menciptakan tarian yang menghibur dan penuh makna spiritual.";

        // Event listeners
        playBtn.addEventListener('click', function() {
            if (isPlaying) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                } else if (currentAudio) {
                    currentAudio.pause();
                }
                isPlaying = false;
                playBtn.textContent = '‚ñ∂';
                playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                modelViewer.autoRotate = false;
                isAutoRotating = false;
                autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
            } else {
                speakText(voiceOverText);
            }
        });

        resetViewBtn.addEventListener('click', resetView);

        autoRotateBtn.addEventListener('click', function() {
            isAutoRotating = !isAutoRotating;
            modelViewer.autoRotate = isAutoRotating;
            autoRotateBtn.innerHTML = isAutoRotating ? '<span>‚è∏</span> Berhenti' : '<span>üîÑ</span> Putar Otomatis';
        });

        zoomInBtn.addEventListener('click', function() {
            const currentOrbit = modelViewer.getCameraOrbit();
            const currentDistance = parseFloat(currentOrbit.radius);
            const newDistance = Math.max(currentDistance * 0.7, 40);
            modelViewer.cameraOrbit = `${currentOrbit.theta}deg ${currentOrbit.phi}deg ${newDistance}%`;
        });

        zoomOutBtn.addEventListener('click', function() {
            const currentOrbit = modelViewer.getCameraOrbit();
            const currentDistance = parseFloat(currentOrbit.radius);
            const newDistance = Math.min(currentDistance * 1.3, 250);
            modelViewer.cameraOrbit = `${currentOrbit.theta}deg ${currentOrbit.phi}deg ${newDistance}%`;
        });

        // Inisialisasi
        window.addEventListener('load', function() {
            console.log('Website Sigale Gale 3D siap digunakan');
            tryLoadDefaultModel();
        });
    </script>
</body>
</html>
