<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigale Gale 3D (Three.js)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        /* CSS DARI KODE ASLI ANDA */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #8B4513, #D2691E);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .model-container {
            width: 100%;
            height: 450px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        /* THREE.JS DITAMPILKAN DI DALAM CANVAS */
        #threejs-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        .model-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            border: none;
            border-radius: 10px;
            padding: 12px 18px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #A0522D, #CD853F);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .object-title {
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: #FFD700;
            font-weight: bold;
        }

        .object-description {
            line-height: 1.7;
            font-size: 1.15rem;
            text-align: center;
            margin-bottom: 25px;
            opacity: 0.95;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #FFD700;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }

        .audio-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: none;
            color: #8B4513;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .audio-btn:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .cultural-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8B4513, #D2691E);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .model-container {
                height: 350px;
            }
            .container {
                padding: 20px;
            }
            .model-controls {
                gap: 8px;
            }
            .control-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            .object-title {
                font-size: 1.8rem;
            }
            .object-description {
                font-size: 1rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 15px;">
            <div class="cultural-badge">Warisan Budaya Batak</div>
        </div>

        <h2 class="object-title">Sigale Gale</h2>

        <div class="model-container">
            <canvas id="threejs-canvas"></canvas>
        </div>

        <div class="model-controls">
            <button class="control-btn" id="reset-view">
                <span>‚Ü∫</span> Reset Posisi
            </button>
            <button class="control-btn" id="auto-rotate">
                <span>üîÑ</span> Putar Otomatis
            </button>
            <button class="control-btn" id="zoom-in">
                <span>‚ûï</span> Perbesar
            </button>
            <button class="control-btn" id="zoom-out">
                <span>‚ûñ</span> Perkecil
            </button>
        </div>

        <p class="object-description">
            Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, 
            yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan 
            dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. 
            Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak.
        </p>

        <div class="audio-controls">
            <button class="audio-btn" id="play-btn">‚ñ∂</button>
        </div>
    </div>

    <script>
        // --- LOGIKA THREE.JS ---

        const container = document.querySelector('.model-container');
        const canvas = document.getElementById('threejs-canvas');
        const width = container.clientWidth;
        const height = container.clientHeight;

        let scene, camera, renderer, controls, model, clock, mixer;
        let isAutoRotating = true;
        const defaultCameraDistance = 3; // Jarak kamera default untuk model
        const maxZoomDistance = 1.5;
        const minZoomDistance = 5;

        function initThreeJS() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000); // Warna latar belakang model-container

            // Camera
            camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
            camera.position.set(0, 1.5, defaultCameraDistance); // Atur posisi kamera awal

            // Renderer
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
            renderer.setSize(width, height);
            renderer.setPixelRatio(window.devicePixelRatio);

            // Controls (Untuk interaksi mouse/touch)
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true; // Untuk gerakan yang lebih halus
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = maxZoomDistance;
            controls.maxDistance = minZoomDistance;
            controls.autoRotate = true; // Rotasi otomatis awal
            controls.autoRotateSpeed = 2.0;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 1.0);
            directionalLight1.position.set(5, 10, 7);
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight2.position.set(-5, 5, -5);
            scene.add(directionalLight2);

            // GLTF Loader
            const loader = new THREE.GLTFLoader();
            clock = new THREE.Clock();

            // GANTI PATH INI DENGAN PATH MODEL SIGALE GALE ANDA!
            loader.load(
                'scene.gltf', // <-- GANTI DENGAN PATH MODEL ANDA
                function (gltf) {
                    model = gltf.scene;
                    
                    // Skala dan posisi model (sesuaikan berdasarkan ukuran model Anda)
                    model.scale.set(1.5, 1.5, 1.5); 
                    model.position.y = -0.5; // Anggap model berdiri di tengah
                    scene.add(model);
                    
                    // Inisialisasi Animation Mixer jika ada animasi
                    if (gltf.animations && gltf.animations.length) {
                        mixer = new THREE.AnimationMixer(model);
                        gltf.animations.forEach((clip) => {
                            mixer.clipAction(clip).play(); // Putar semua animasi
                        });
                        console.log('Animasi 3D dimuat dan diputar.');
                    }
                    console.log('Model Sigale Gale dimuat menggunakan Three.js.');
                },
                undefined,
                function (error) {
                    console.error('Error memuat model 3D:', error);
                    alert('Gagal memuat model 3D. Pastikan file "models/SigaleGale.glb" tersedia dan path-nya benar.');
                }
            );

            animate();
        }

        // Loop Render
        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            
            // Update Animation Mixer
            if (mixer) {
                mixer.update(delta);
            }

            // Update controls (penting untuk damping dan auto-rotate)
            controls.update();

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            const newWidth = container.clientWidth;
            const newHeight = container.clientHeight;
            camera.aspect = newWidth / newHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(newWidth, newHeight);
        }

        window.addEventListener('resize', onWindowResize);
        
        // Inisialisasi Three.js
        initThreeJS();


        // --- LOGIKA KONTROL & AUDIO (Diadaptasi dari kode asli) ---

        const playBtn = document.getElementById('play-btn');
        const resetViewBtn = document.getElementById('reset-view');
        const autoRotateBtn = document.getElementById('auto-rotate');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');

        let currentAudio = null;
        let isPlaying = false;

        // Fungsi untuk text-to-speech
        function speakText(text) {
            if (currentAudio && isPlaying) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                } else if (currentAudio.pause) {
                    currentAudio.pause();
                }
                isPlaying = false;
                playBtn.textContent = '‚ñ∂';
                playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                // Jangan lupa hentikan rotasi model
                controls.autoRotate = false;
                isAutoRotating = false;
                autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
                return;
            }

            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;

                utterance.onstart = function() {
                    isPlaying = true;
                    playBtn.textContent = '‚è∏';
                    playBtn.style.background = 'linear-gradient(135deg, #FF8C00, #FF6347)';
                    // Mulai rotasi otomatis saat audio berjalan
                    controls.autoRotate = true;
                    isAutoRotating = true;
                    autoRotateBtn.innerHTML = '<span>‚è∏</span> Berhenti';
                };

                utterance.onend = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                    // Hentikan rotasi dan reset tampilan setelah selesai
                    resetView();
                };

                utterance.onerror = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                    alert('Terjadi error pada voice over.');
                };

                speechSynthesis.speak(utterance);
                currentAudio = utterance;
            } else {
                 alert('Browser Anda tidak mendukung Web Speech API (Text-to-Speech).');
            }
        }

        // Fungsi reset view (diadaptasi untuk OrbitControls)
        function resetView() {
            controls.reset(); // Reset posisi kamera dan target
            controls.autoRotate = false;
            isAutoRotating = false;
            autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
        }

        // Teks untuk voice over
        const voiceOverText = "Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak. Gerakan patung ini dikendalikan oleh tali-tali yang dioperasikan oleh beberapa orang, menciptakan tarian yang menghibur dan penuh makna spiritual.";

        // Event listener untuk tombol play/pause audio
        playBtn.addEventListener('click', function() {
            speakText(voiceOverText);
        });

        // Event listener untuk tombol reset view
        resetViewBtn.addEventListener('click', function() {
            resetView();
        });

        // Event listener untuk tombol auto rotate
        autoRotateBtn.addEventListener('click', function() {
            isAutoRotating = !isAutoRotating;
            controls.autoRotate = isAutoRotating;
            autoRotateBtn.innerHTML = isAutoRotating ? '<span>‚è∏</span> Berhenti' : '<span>üîÑ</span> Putar Otomatis';
        });

        // Event listener untuk tombol zoom in
        zoomInBtn.addEventListener('click', function() {
            // Memperkecil jarak kamera (mendekati)
            controls.dollyOut(1.2); 
            controls.update();
        });

        // Event listener untuk tombol zoom out
        zoomOutBtn.addEventListener('click', function() {
            // Memperbesar jarak kamera (menjauhi)
            controls.dollyIn(1.2); 
            controls.update();
        });

        // Pastikan rotasi awal diatur
        resetView(); // Panggil reset view agar autoRotate default mengikuti tombol
        controls.autoRotate = true;
        isAutoRotating = true;
        autoRotateBtn.innerHTML = '<span>‚è∏</span> Berhenti';
    </script>
</body>
</html>
