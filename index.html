<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sigale Gale 3D</title>
    <script src="https://cdn.jsdelivr.net/npm/@google/model-viewer@2.1.1/dist/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2a6c, #8B4513, #D2691E);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .model-container {
            width: 100%;
            height: 450px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 15px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 15px;
            z-index: 10;
            border-radius: 15px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .model-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            border: none;
            border-radius: 10px;
            padding: 12px 18px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .control-btn:hover {
            background: linear-gradient(135deg, #A0522D, #CD853F);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .object-title {
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            color: #FFD700;
            font-weight: bold;
        }

        .object-description {
            line-height: 1.7;
            font-size: 1.15rem;
            text-align: center;
            margin-bottom: 25px;
            opacity: 0.95;
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #FFD700;
        }

        .audio-controls {
            display: flex;
            justify-content: center;
            margin-top: 25px;
        }

        .audio-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            border: none;
            color: #8B4513;
            font-size: 1.8rem;
            font-weight: bold;
        }

        .audio-btn:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .cultural-badge {
            display: inline-block;
            background: linear-gradient(135deg, #8B4513, #D2691E);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-bottom: 15px;
            font-weight: 500;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .material-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .material-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .material-btn:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .material-btn.active {
            background: #FFD700;
            color: #8B4513;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .model-container {
                height: 350px;
            }
            
            .container {
                padding: 20px;
            }
            
            .model-controls {
                gap: 8px;
            }
            
            .control-btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }
            
            .object-title {
                font-size: 1.8rem;
            }
            
            .object-description {
                font-size: 1rem;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 15px;">
            <div class="cultural-badge">Warisan Budaya Batak</div>
        </div>
        
        <div class="model-container">
            <div class="loading-overlay" id="loading-overlay">
                <div class="spinner"></div>
                <div>Memuat model 3D...</div>
            </div>
            <model-viewer 
                id="model-viewer"
                src="scene.glb" 
                alt="Model 3D Sigale Gale"
                auto-rotate 
                camera-controls
                shadow-intensity="1.5"
                environment-image="neutral"
                camera-orbit="0deg 75deg 105%"
                exposure="1.5"
                ar
                ar-modes="webxr scene-viewer quick-look"
                ios-src="sigale-gale.usdz">
                
                <!-- Fallback untuk browser yang tidak support -->
                <div slot="poster">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                        <div>Loading Sigale Gale 3D...</div>
                    </div>
                </div>
            </model-viewer>
        </div>
        
        <div class="material-controls">
            <button class="material-btn active" data-environment="neutral">Pencahayaan Normal</button>
            <button class="material-btn" data-environment="legacy">Pencahayaan Hangat</button>
            <button class="material-btn" data-environment="spruit">Pencahayaan Terang</button>
        </div>
        
        <div class="model-controls">
            <button class="control-btn" id="reset-view">
                <span>‚Ü∫</span> Reset Posisi
            </button>
            <button class="control-btn" id="auto-rotate">
                <span>üîÑ</span> Putar Otomatis
            </button>
            <button class="control-btn" id="zoom-in">
                <span>üîç</span> Perbesar
            </button>
            <button class="control-btn" id="zoom-out">
                <span>üëÅÔ∏è</span> Perkecil
            </button>
        </div>
        
        <h2 class="object-title">Sigale Gale</h2>
        <p class="object-description">
            Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, 
            yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan 
            dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. 
            Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak 
            dengan ukiran dan warna khas.
        </p>
        
        <div class="audio-controls">
            <button class="audio-btn" id="play-btn">‚ñ∂</button>
        </div>
    </div>

    <script>
        // Elemen DOM
        const playBtn = document.getElementById('play-btn');
        const modelViewer = document.getElementById('model-viewer');
        const resetViewBtn = document.getElementById('reset-view');
        const autoRotateBtn = document.getElementById('auto-rotate');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const loadingOverlay = document.getElementById('loading-overlay');
        const materialBtns = document.querySelectorAll('.material-btn');

        let currentAudio = null;
        let isPlaying = false;
        let isAutoRotating = true;

        // Event listener untuk model viewer
        modelViewer.addEventListener('load', () => {
            console.log('Model 3D berhasil dimuat');
            loadingOverlay.style.display = 'none';
            
            // Cek material dan texture
            checkMaterials();
        });

        modelViewer.addEventListener('error', (event) => {
            console.error('Error loading model:', event.detail);
            loadingOverlay.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">‚ö†Ô∏è</div>
                    <div>Gagal memuat model 3D</div>
                    <div style="font-size: 0.8rem; margin-top: 10px; opacity: 0.8;">
                        Pastikan file sigale-gale.glb ada di folder yang sama
                    </div>
                </div>
            `;
        });

        // Fungsi untuk memeriksa material
        function checkMaterials() {
            // Tunggu sebentar untuk memastikan model sudah ter-render
            setTimeout(() => {
                const scene = modelViewer.model;
                if (scene) {
                    console.log('Scene loaded:', scene);
                    scene.traverse((node) => {
                        if (node.isMesh) {
                            console.log('Mesh found:', node.name);
                            console.log('Material:', node.material);
                            if (node.material) {
                                console.log('Material properties:', {
                                    color: node.material.color,
                                    map: node.material.map,
                                    roughness: node.material.roughness,
                                    metalness: node.material.metalness
                                });
                            }
                        }
                    });
                }
            }, 1000);
        }

        // Fungsi untuk text-to-speech
        function speakText(text) {
            // Hentikan audio sebelumnya jika sedang berjalan
            if (currentAudio && isPlaying) {
                currentAudio.pause();
                isPlaying = false;
                playBtn.textContent = '‚ñ∂';
            }

            // Gunakan Web Speech API jika tersedia
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'id-ID';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    isPlaying = true;
                    playBtn.textContent = '‚è∏';
                    playBtn.style.background = 'linear-gradient(135deg, #FF8C00, #FF6347)';
                };
                
                utterance.onend = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                    autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
                    modelViewer.autoRotate = false;
                    isAutoRotating = false;
                    resetView();
                };
                
                utterance.onerror = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                    alert('Terjadi error pada voice over. Pastikan browser mendukung text-to-speech.');
                };
                
                speechSynthesis.speak(utterance);
                currentAudio = utterance;
                
                // Mulai rotasi otomatis saat audio berjalan
                modelViewer.autoRotate = true;
                isAutoRotating = true;
                autoRotateBtn.innerHTML = '<span>‚è∏</span> Berhenti';
                
            } else {
                // Fallback menggunakan audio placeholder jika Web Speech API tidak tersedia
                const audio = new Audio("https://www.soundjay.com/button/beep-07.wav");
                audio.play();
                
                isPlaying = true;
                playBtn.textContent = '‚è∏';
                playBtn.style.background = 'linear-gradient(135deg, #FF8C00, #FF6347)';
                
                audio.onended = function() {
                    isPlaying = false;
                    playBtn.textContent = '‚ñ∂';
                    playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                };
                
                currentAudio = audio;
            }
        }

        // Fungsi reset view
        function resetView() {
            modelViewer.cameraOrbit = "0deg 75deg 105%";
            modelViewer.autoRotate = false;
            isAutoRotating = false;
            autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
        }

        // Teks untuk voice over
        const voiceOverText = "Sigale Gale adalah patung kayu tradisional dari suku Batak, Sumatra Utara, yang dapat menari dan bergerak seperti manusia. Patung ini biasanya digunakan dalam upacara adat untuk menghibur roh orang yang telah meninggal tanpa keturunan. Sigale Gale memiliki tinggi sekitar 1,5 meter dan dihiasi pakaian tradisional Batak dengan ukiran dan warna khas. Gerakan patung ini dikendalikan oleh tali-tali yang dioperasikan oleh beberapa orang, menciptakan tarian yang menghibur dan penuh makna spiritual.";

        // Event listener untuk tombol play/pause audio
        playBtn.addEventListener('click', function() {
            if (isPlaying) {
                if ('speechSynthesis' in window) {
                    speechSynthesis.cancel();
                } else if (currentAudio) {
                    currentAudio.pause();
                }
                isPlaying = false;
                playBtn.textContent = '‚ñ∂';
                playBtn.style.background = 'linear-gradient(135deg, #FFD700, #FFA500)';
                modelViewer.autoRotate = false;
                isAutoRotating = false;
                autoRotateBtn.innerHTML = '<span>üîÑ</span> Putar Otomatis';
            } else {
                speakText(voiceOverText);
            }
        });

        // Event listener untuk tombol reset view
        resetViewBtn.addEventListener('click', function() {
            resetView();
        });

        // Event listener untuk tombol auto rotate
        autoRotateBtn.addEventListener('click', function() {
            isAutoRotating = !isAutoRotating;
            modelViewer.autoRotate = isAutoRotating;
            autoRotateBtn.innerHTML = isAutoRotating ? '<span>‚è∏</span> Berhenti' : '<span>üîÑ</span> Putar Otomatis';
        });

        // Event listener untuk tombol zoom in
        zoomInBtn.addEventListener('click', function() {
            const currentOrbit = modelViewer.getCameraOrbit();
            const currentDistance = parseFloat(currentOrbit.radius);
            const newDistance = Math.max(currentDistance * 0.7, 40);
            modelViewer.cameraOrbit = `${currentOrbit.theta}deg ${currentOrbit.phi}deg ${newDistance}%`;
        });

        // Event listener untuk tombol zoom out
        zoomOutBtn.addEventListener('click', function() {
            const currentOrbit = modelViewer.getCameraOrbit();
            const currentDistance = parseFloat(currentOrbit.radius);
            const newDistance = Math.min(currentDistance * 1.3, 250);
            modelViewer.cameraOrbit = `${currentOrbit.theta}deg ${currentOrbit.phi}deg ${newDistance}%`;
        });

        // Event listener untuk kontrol material
        materialBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const environment = this.getAttribute('data-environment');
                modelViewer.environmentImage = environment;
                
                // Update active state
                materialBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Inisialisasi
        window.addEventListener('load', function() {
            console.log('Website Sigale Gale 3D siap digunakan');
            // Set exposure untuk pencahayaan yang lebih baik
            modelViewer.exposure = 1.5;
            modelViewer.shadowIntensity = 1.5;
        });
    </script>
</body>
</html>
